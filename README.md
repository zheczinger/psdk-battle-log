# Battle Log for PSDK
![GitHub Release](https://img.shields.io/github/v/release/zheczinger/psdk-battle-log?display_name=release&color=blue&style=for-the-badge)
![PSDK Version](https://img.shields.io/badge/psdk-.26.52+-6961F6?style=for-the-badge)

- **:package: [Installation](#package-installation)**
- **:earth_americas: [Languages](#earth_americas-languages)**
- **:gear: [Configuration](#gear-configuration)**
- **:bug: [Limitations](#bug-limitations)**
- **:handshake: [Compatibility](#handshake-compatibility)**
- **:mega: [Credits](#mega-credits)**

<img width="320" height="240" alt="battle_log_1" src="https://github.com/user-attachments/assets/2bcc067f-ee65-4089-a889-3ef66fa10ca2" />
<img width="320" height="240" alt="battle_log_2" src="https://github.com/user-attachments/assets/f191e59b-422b-4603-80a0-6b4a91d0177b" />

Forgot or missed what happened in a past turn during a battle? This PSDK plugin adds a battle log that you can view during a battle.

To open the battle log, press the `L` game button while in the player choice menu (the menu that has Attack, Party, Item, and Flee as choices). Unless your project changes the key bindings, the `L` game button is binded to the `F` key.

| Game Button | Action |
| -- | -- |
| :arrow_up: | Scroll up 1 message |
| :arrow_down: | Scroll down 1 message |
| :arrow_left: | Go back 1 turn |
| :arrow_right: | Go forward 1 turn |
| **`C`** | Expand or collapse the selected message |
| **`B`** | Return to the player menu, or collapse the selected message if expanded |

## :package: Installation
**To install:**
1. Download `ZVBattleLog.psdkplug` and `193207.csv` from the [newest release](https://github.com/zheczinger/psdk-battle-log/releases/latest).
2. Put the downloaded .psdkplug file in the `scripts` folder in your project.
3. Open the `cmd.bat` file in your project. This will bring up a command prompt.
4. Enter `psdk --util=plugin load` in the command prompt.
5. Put the downloaded .csv file in the `Data/Text/Dialogs` folder in your project.

If you're already using the `193207.csv` filename for a different file, then you can rename this plugin's CSV file to a different `1NNNNN.csv` file. Change the number in the `csv_id` field in this plugin's JSON config file to the `NNNNN` number you picked.

**To uninstall:**
1. Delete `ZVBattleLog.psdkplug` from the `scripts` folder in your project.
2. Open the `cmd.bat` file in your project. This will bring up a command prompt.
3. Enter `psdk --util=plugin load` in the command prompt. Enter `Y` when asked whether to remove the files added by the plugin.
3. Delete `193207.csv` or whatever you named that CSV file from the `Data/Text/Dialogs` folder in your project.

## **:earth_americas: Languages**
- English :us:

## :gear: Configuration
The following settings are available in the `Data/configs/plugins/zv_battle_log_config.json` file in your project.

```json
{
  "csv_id": 93207,
  "prefix": "zv-battle-log",
  "hp_measurement": "percent",
  "open_button": "L",
  "bonus_message_color": 7
}
```

| Key | Expected Value | Default Value | Description |
| -- | -- | -- | -- |
| **`csv_id`** | Integer $âŠ†$ [0, 99999] | 93207 | ID of the plugin's CSV file. |
| **`prefix`** | String | "zv-battle-log" | Subfolder name for this plugin's interface graphics. |
| **`hp_measurement`** | String | "percent" | How health lost or restored is reported in the battle log. The choices are `"percent"` (percentage of the battler's max health), `"points"` (exact HP quantity), and `"both"`. |
| **`open_button`** | String | "L" | Game button to press during the player choice menu to open the battle log. |
| **`bonus_message_color`** | Integer | 7 | Color ID for supplemental log messages generated by the plugin based on the `graphics/windowskins/_colors.png` file in your project. These messages are exclusive to the log; they aren't shown in the actual battle scene. |

## :bug: Limitations
The battle log currently doesn't parse special message instructions typically seen in event text, such as `:[name=TrainerName]:`, `\c[0]`, etc.. The battle scene's text window processes them just fine, but the battle log will render them in their raw text form.

These instructions are often used in mid-battle dialogue. One alternative is to disable the logging temporarily. For example, if you had defined a utility function for playing dialogue during a battle event like below:

```ruby
def scene.show_message(*messages)
  messages.each do |message|
    message_window.blocking = true
    message_window.wait_input = true
    display_message_and_wait(message)
  end
end
```

Then you could disable the logging of messages during this period by making this change:

```ruby
def scene.show_message(*messages)
  zv_log.with_attributes(enable_logging: false) do
    messages.each do |message|
      message_window.blocking = true
      message_window.wait_input = true
      display_message_and_wait(message)
    end
  end
end
```

## :handshake: Compatibility
- [Modernized Battle Messages for PSDK](https://github.com/zheczinger/psdk-modernized-battle-messages): Requires v0.5.1 or newer version of that plugin to be compatible with this plugin. Battle messages replaced or silenced by that plugin are preserved in this plugin's battle log.

## :mega: Credits
**Author:**
- zhec
